<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Tailor Cart | Tailor Inbox</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Global CSS -->
    <link rel="stylesheet" href="../styles/style.css" />

    <!-- ‚úÖ Tailor guard -->
    <script src="../scripts/guards/tailor-guard.js"></script>

    <style>
      :root {
        --tc-border: rgba(15, 23, 42, 0.10);
        --tc-muted: rgba(15, 23, 42, 0.60);
        --tc-soft: rgba(15, 23, 42, 0.04);
        --tc-soft2: rgba(15, 23, 42, 0.06);
        --tc-accent: #d97706;
        --tc-ink: rgba(15, 23, 42, 0.92);
      }

      body {
        background:
          radial-gradient(1200px 500px at 15% -10%, rgba(217, 119, 6, 0.10), transparent 60%),
          radial-gradient(1000px 600px at 100% 0%, rgba(99, 102, 241, 0.08), transparent 55%),
          #fff;
      }

      .tc-page-head {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 14px;
      }
      .tc-page-title {
        margin: 0;
        font-weight: 750;
        letter-spacing: -0.02em;
        color: var(--tc-ink);
      }
      .tc-page-sub {
        color: rgba(15, 23, 42, 0.62);
      }

      .tc-search-wrap {
        position: relative;
        width: min(360px, 100%);
      }
      .tc-search-ico {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
        color: rgba(15, 23, 42, 0.45);
        pointer-events: none;
      }
      .tc-search {
        padding-left: 34px;
        border-radius: 999px;
        border: 1px solid var(--tc-border);
        background: rgba(255,255,255,.92);
        height: 36px;
      }
      .tc-search:focus {
        box-shadow: 0 0 0 4px rgba(217, 119, 6, 0.12);
        border-color: rgba(217, 119, 6, 0.28);
      }

      .tc-inbox-shell {
        border: 1px solid var(--tc-border);
        border-radius: 20px;
        overflow: hidden;
        background: rgba(255,255,255,.85);
        backdrop-filter: blur(8px);
        box-shadow: 0 18px 50px rgba(15, 23, 42, 0.08);
      }

      .tc-left {
        border-right: 1px solid var(--tc-border);
        min-height: 74vh;
        background: #fff;
        display: flex;
        flex-direction: column;
      }

      .tc-right {
        min-height: 74vh;
        background: #fff;
        display: flex;
        flex-direction: column;
      }

      .tc-pane-head {
        position: sticky;
        top: 0;
        z-index: 10;
        background: rgba(255, 255, 255, 0.94);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--tc-border);
      }

      .tc-seg {
        display: inline-flex;
        border: 1px solid var(--tc-border);
        background: rgba(255,255,255,.95);
        border-radius: 999px;
        padding: 4px;
        gap: 4px;
      }
      .tc-seg button {
        border: 0;
        background: transparent;
        padding: 8px 12px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 13px;
        color: rgba(15, 23, 42, 0.72);
        transition: background .12s ease, color .12s ease, transform .08s ease;
      }
      .tc-seg button:hover { background: rgba(15, 23, 42, 0.04); }
      .tc-seg button:active { transform: scale(0.98); }
      .tc-seg button.is-active {
        background: rgba(217, 119, 6, 0.16);
        color: rgba(15, 23, 42, 0.95);
      }

      .tc-threads-scroll {
        flex: 1;
        overflow: auto;
      }

      .tc-thread {
        display: flex;
        gap: 12px;
        padding: 12px 14px;
        cursor: pointer;
        border-bottom: 1px solid rgba(15, 23, 42, 0.06);
        transition: background 0.12s ease, transform 0.08s ease;
      }
      .tc-thread:hover { background: var(--tc-soft); }
      .tc-thread:active { transform: scale(0.995); }
      .tc-thread.active { background: rgba(217, 119, 6, 0.10); }

      .tc-avatar-wrap {
        position: relative;
        width: 46px;
        height: 46px;
        flex: 0 0 auto;
      }

      .tc-avatar {
        width: 46px;
        height: 46px;
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid var(--tc-border);
        background: var(--tc-soft2);
        display: grid;
        place-items: center;
        font-weight: 800;
      }
      .tc-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .tc-online-dot {
        position: absolute;
        right: 2px;
        bottom: 2px;
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: #22c55e;
        border: 2px solid #fff;
        box-shadow: 0 2px 8px rgba(0,0,0,.12);
      }

      .tc-thread-main { min-width: 0; flex: 1; }
      .tc-thread-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .tc-thread-name {
        font-weight: 800;
        line-height: 1.1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 240px;
      }
      .tc-thread-time {
        font-size: 12px;
        color: rgba(15, 23, 42, 0.55);
        white-space: nowrap;
      }

      .tc-thread-last {
        font-size: 13px;
        color: rgba(15, 23, 42, 0.68);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 260px;
      }

      .tc-unread {
        font-size: 12px;
        background: var(--tc-accent);
        color: #fff;
        border-radius: 999px;
        padding: 2px 8px;
        font-weight: 800;
      }

      .tc-badges {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 6px;
      }

      .tc-pill {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid var(--tc-border);
        color: rgba(15,23,42,.72);
        background: #fff;
        font-weight: 700;
      }
      .tc-pill.tc-order {
        border-color: rgba(217, 119, 6, .35);
        background: rgba(217, 119, 6, .10);
      }
      .tc-pill.tc-locked {
        border-color: rgba(239, 68, 68, .35);
        background: rgba(239, 68, 68, .10);
        color: rgba(127, 29, 29, 0.95);
      }

      .tc-right-empty {
        height: 100%;
        display: grid;
        place-items: center;
        text-align: center;
        padding: 40px 26px;
        color: rgba(15, 23, 42, 0.62);
      }
      .tc-right-empty .tc-ico {
        width: 68px;
        height: 68px;
        border-radius: 22px;
        display: grid;
        place-items: center;
        background: rgba(217, 119, 6, 0.12);
        margin: 0 auto 14px;
        font-size: 28px;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.06);
      }

      @media (max-width: 992px) {
        .tc-left {
          border-right: none;
          border-bottom: 1px solid var(--tc-border);
          min-height: unset;
        }
        .tc-page-head { align-items: flex-start; }
        .tc-search-wrap { width: 100%; }
      }
    </style>
  </head>

  <body>
    <!-- NAVBAR -->
    <nav
      class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top tc-navbar"
    >
      <div class="container">
        <!-- Brand -->
        <a class="navbar-brand fw-bold brand-logo" href="index.html"
          >Tailor Cart</a
        >

        <!-- Mobile toggle -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#mainNavbar"
          aria-controls="mainNavbar"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNavbar">
          <!-- Nav links -->
          <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#categories">Categories</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="tailors.html">Find Tailors</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#how-it-works"
                >How It Works</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About Us</a>
            </li>
          </ul>

          <!-- RIGHT SIDE: GUEST -->
          <div class="d-flex gap-2 align-items-center" id="navGuest">
            <a
              href="login.html"
              class="btn btn-link text-decoration-none nav-link-btn"
              >Sign In</a
            >
            <a
              href="signup-tailor.html"
              class="btn btn-primary btn-join-tailor tc-magnetic"
              >Join as Tailor</a
            >
          </div>

          <!-- RIGHT SIDE: AUTH -->
          <div class="d-none" id="navAuth">
            <div class="nav-auth-wrap">
              <!-- User pill dropdown -->
              <div class="dropdown">
                <button
                  class="btn nav-user-btn dropdown-toggle"
                  type="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <span class="nav-user-pill">
                    <span class="nav-user-dot"></span>
                    <span class="nav-user-text"
                      >Hi, <span id="navUserName">User</span></span
                    >
                  </span>
                </button>

                <!-- Upgraded dropdown -->
                <ul class="dropdown-menu dropdown-menu-end tc-dd">
                  <!-- Header -->
                  <li>
                    <div class="tc-dd__head">
                      <div class="tc-dd__avatar" id="navUserAvatar">U</div>
                      <div>
                        <p class="tc-dd__name mb-0" id="navUserNameMenu">
                          User
                        </p>
                        <p class="tc-dd__meta mb-0">Tailor Cart Account</p>
                      </div>
                    </div>
                  </li>

                  <li><div class="tc-dd__label">Quick Actions</div></li>

                  <li>
                    <a class="dropdown-item" href="profile.html">
                      <span class="tc-dd__ico">üë§</span>
                      <span>My Profile</span>
                    </a>
                  </li>

                  <li>
                    <a class="dropdown-item" href="customer-dashboard.html">
                      <span class="tc-dd__ico">üßæ</span>
                      <span>My Orders</span>
                    </a>
                  </li>

                  <li>
                    <a class="dropdown-item" href="tailors.html">
                      <span class="tc-dd__ico">‚úÇÔ∏è</span>
                      <span>Find Tailors</span>
                    </a>
                  </li>

                  <li><hr class="dropdown-divider" /></li>

                  <li>
                    <button
                      class="dropdown-item text-danger"
                      id="navLogoutBtn"
                      type="button"
                    >
                      <span class="tc-dd__ico">‚éã</span>
                      <span>Logout</span>
                    </button>
                  </li>
                </ul>
              </div>

              <!-- Separate button -->
              <a
                href="tailors.html"
                class="btn btn-primary btn-join-tailor nav-neworder-btn tc-magnetic"
                >+ New Order</a
              >
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- PAGE -->
    <main class="py-4">
      <div class="container">
        <div class="tc-page-head">
          <div>
            <h3 class="tc-page-title">Inbox</h3>
            <div class="small tc-page-sub">Customer inquiries + order chats in one place.</div>
          </div>

          <div class="d-flex gap-2 align-items-center flex-wrap justify-content-end">
            <div class="tc-search-wrap">
              <span class="tc-search-ico">üîé</span>
              <input
                id="tcInboxSearch"
                class="form-control form-control-sm tc-search"
                placeholder="Search customer or message..."
              />
            </div>
            <button id="tcInboxRefresh" class="btn btn-sm btn-outline-secondary">‚Üª Refresh</button>
          </div>
        </div>

        <div class="tc-inbox-shell">
          <div class="row g-0">
            <!-- LEFT -->
            <div class="col-lg-4 tc-left">
              <div class="tc-pane-head p-3">
                <div class="d-flex align-items-center justify-content-between gap-2">
                  <div class="fw-semibold">Messages</div>
                  <div class="small text-muted"><span id="tcInboxCount">0</span></div>
                </div>

                <div class="mt-3 d-flex align-items-center justify-content-between gap-2">
                  <div class="tc-seg" role="tablist" aria-label="Inbox Categories">
                    <button id="tcTabInquiry" type="button" data-tab="INQUIRY">Inquiries</button>
                    <button id="tcTabOrders" class="is-active" type="button" data-tab="ORDER">Orders</button>
                  </div>

                  <div class="small text-muted" id="tcTabMeta">Order chats</div>
                </div>
              </div>

              <div class="tc-threads-scroll" id="tcThreads"></div>

              <div class="p-3 small text-muted d-none" id="tcThreadsEmpty">
                No conversations in this category yet.
              </div>
            </div>

            <!-- RIGHT -->
            <div class="col-lg-8 tc-right">
              <div id="tcChatFrame" class="h-100">
                <div class="tc-right-empty">
                  <div>
                    <div class="tc-ico">üí¨</div>
                    <div class="fw-semibold">Select a chat</div>
                    <div class="small mt-1">Choose an inquiry or order chat from the left.</div>
                    <div class="small mt-2 text-muted">Tip: Order chats close after customer review is submitted.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Shared -->
    <script src="../scripts/navbar-auth.js"></script>
    <script src="../scripts/authStore.js"></script>

    <!-- ‚úÖ Tailor Inbox logic -->
    <script src="../scripts/tailor-inbox.js"></script>
  </body>
</html>
